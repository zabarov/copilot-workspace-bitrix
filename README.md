# Bitrix Copilot Workspace

Этот репозиторий — рабочая площадка для разработки и сопровождения Bitrix-проектов силами GitHub Copilot и специализированных агентов. Он объединяет требования, архитектуру, тестовые данные, артефакты поставки и инструкции, чтобы можно было запускать новый модуль, собирать релиз и вести документацию без переключения в другие хранилища.

## Роли агентов

- **00-help-assistant** — вспомогательный проводник по Workspace: отвечает на вопросы о структуре проекта, подборе агентов и безопасных изменениях в документации и `.agent.md`.
- **10-requirements-create** — из сырых идей и черновых ТЗ формирует структурированные требования в `inputs/requirements/**`, при необходимости обновляя `inputs/README.md`.
- **10-domain-describe** — описывает предметную область по актуальным требованиям, поддерживает глоссарий, сущности и бизнес-правила в `inputs/domain/**`.
- **20-architecture-plan** — на основе требований и домена готовит архитектурный план, наполняет `inputs/design/**` (и при необходимости `docs/architecture/**`).
- **20-batches-plan** — планирует работу батчами, ведёт `inputs/batches/pipeline.json` и описательные YAML-файлы батчей.
- **30-bitrix-module-create** — создаёт минимальный каркас модуля Bitrix D7 в `local/modules/<module_id>/`, если проект стартует с нуля.
- **30-code-build** — реализует выбранные батчи: меняет код в `local/**`, запускает проверки и пишет логи в `results/batches/**` и `results/checks/**`.
- **40-tests-run** — запускает PHPUnit, PHPStan, PHP-CS-Fixer (dry-run) и другие анализаторы, сохраняя отчёты в `results/checks/**`.
- **40-code-review** — проводит код-ревью изменений в `local/**`, оформляет замечания в `results/reviews/**`.
- **50-docs-update** — синхронизирует реализацию с документацией, обновляет `docs/**`, ADR, cookbook и сопутствующие материалы.
- **60-release-build** — собирает релизные артефакты по диапазону коммитов в `packages/releases/<start>-<end>/` и добавляет README.
- **60-bitrix-update-build** — формирует пакет обновления Bitrix-модуля на основе релиза в `packages/updates/<version>/` (структура `install/`, `updater.php`, README).

## Рабочий процесс

1. Зафиксируйте идею или ТЗ в любом удобном виде — это исходный материал для аналитики; при сомнениях по шагам обратитесь к **00-help-assistant**.
2. Запустите **10-requirements-create**, чтобы перенести требования в структуру `inputs/requirements/**` и обновить оглавление.
3. Запустите **10-domain-describe**, чтобы пополнить `inputs/domain/**` глоссарием, сущностями и бизнес-правилами.
4. Передайте контекст **20-architecture-plan** — агент подготовит архитектурный план в `inputs/design/**` (и при необходимости `docs/architecture/**`).
5. С помощью **20-batches-plan** разбейте работу на батчи и опишите их в `inputs/batches/**`.
6. Если проект стартует с чистого листа, вызовите **30-bitrix-module-create**, чтобы получить каркас в `local/modules/<module_id>/`.
7. Для реализации батчей запускайте **30-code-build**: агент правит `local/**`, запускает проверки и обновляет `results/**`.
8. Подключайте **40-tests-run** для регламентных прогонов PHPUnit/PHPStan/PHP-CS-Fixer и фиксации логов в `results/checks/**`.
9. Используйте **40-code-review**, чтобы получить структурированное ревью изменений и отчёты в `results/reviews/**`.
10. После завершения разработки синхронизируйте знания с документацией через **50-docs-update**, обновив `docs/**`.
11. Для поставки изменений соберите релиз **60-release-build**, а затем при необходимости подготовьте пакет обновления **60-bitrix-update-build**.

## Структура репозитория

| Каталог | Назначение |
| --- | --- |
| `.git/` | История git и служебные объекты; не изменяем вручную. |
| `.github/` | CI/automation, инструкции агентов и дополнительные конфиги GitHub. |
| `docs/` | Архитектура, ADR, DSL, cookbook и прочая постоянная документация. |
| `examples/` | Демонстрационные материалы: `snapshots/` (jsonl-снапшоты), `links/` (примеры проектов), `files/` (мелкие вложения). |
| `inputs/` | Требования, промпты, батчи и другая оперативная информация для планирования. |
| `local/` | Исходники Bitrix-модуля (код живёт в `local/modules/<module_id>/`). |
| `packages/` | Готовые релизные (`releases/`) и обновленческие (`updates/`) пакеты; содержимое игнорируется git. |
| `phpstan/` | Bootstrap и заглушки для статического анализа Bitrix-кода. |
| `results/` | Рабочие артефакты: `checks/` (логи PHPStan/PHPUnit/CS) и `batches/` (отчёты об исполнении батчей). |
| `vendor/` | Зависимости Composer, в том числе инструменты (`phpunit`, `phpstan`, `php-cs-fixer`). |

Дополнительно в корне лежат конфигурации (`phpstan.neon`, `deptrac.yaml`, `.php-cs-fixer.dist.php`) и Composer-манифесты, которыми пользуется исполнительский контур (`30-code-build`, `40-tests-run` и другие агенты) при выполнении проверок.

## Полезные команды

```bash
composer install
vendor/bin/phpunit --log-junit results/checks/phpunit-junit.xml
vendor/bin/phpstan analyse -c phpstan.neon
vendor/bin/php-cs-fixer fix --config=.php-cs-fixer.dist.php --dry-run --diff
```

Команды выше запускаются из корня репозитория. Результаты статических анализаторов и тестов можно складывать в `results/checks/` для последующего анализа агентами `20-batches-plan`, `30-code-build`, `40-tests-run` и `50-docs-update`.

