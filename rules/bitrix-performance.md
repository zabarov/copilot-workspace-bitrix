# Производительность и эксплуатация (1С-Битрикс)

Рекомендации для высоконагруженных проектов и сопровождения, основанные на курсах «Композитный сайт», «Разработка и эксплуатация высоконагруженных проектов», «Многосайтовость», «BitrixVM».

## Композит и кэш
- Включайте композит для публичных страниц; выделяйте динамические области через фреймы/`php_interface/init.php` настройки.
- Управляемый кэш: минимизируйте длительность кэша там, где данные часто меняются; сбрасывайте кэш на событиях изменения сущностей.
- Не кэшируйте персональные данные без разделения по пользователю; учитывайте права доступа в кэше.
- Используйте CDN и оптимизацию картинок (пропорциональный resize, webp при возможности).
- При работе с блоками/шаблонами избегайте дублирования: общий код выносите, используйте категории/типы блоков вместо копирования.

## База данных и данные
- Индексируйте поля, участвующие в фильтрах/сортировках; избегайте `SELECT *`, используйте постраничную выборку.
- Для больших списков — пагинация/seek, денормализация и справочники в HL-блоках; разграничивайте горячие/холодные данные.
- Избегайте N+1: агрегируйте запросы, используйте кешированные выборки, `with`-загрузку в ORM.

## Очереди и фоновые задачи
- Выносите тяжёлые операции в агенты/cron/очереди; следите за частотой агентов, не держите длительные запросы в вебе.
- Логируйте длительные операции, ошибки интеграций, ретраи; используйте отдельные таблицы/файлы для логов.

## Архитектура и многосайтовость
- Для многосайтовости используйте корректные привязки к SITE\_ID, SITE\_DIR; не хардкодьте URL.
- Конфигурацию окружения храните в `.settings.php`/`.settings_extra.php`; разделяйте боевое/тестовое окружение.
- При кластеризации учитывайте необходимость репликации файлов (shared storage) и сессий (memcached/redis).

## Безопасность и эксплуатация
- Регулярные бэкапы БД и файлов, проверка восстановления.
- Обновления ядра/модулей — по регламенту, с тестированием на стенде.
- Мониторинг: нагрузка, время ответа, ошибки PHP, логи веб-сервера, очередь агентов/cron.
- Ограничьте доступ к админке, включайте двуфакторку, журналируйте изменения.

## Тестирование производительности
- Используйте профайлер/монитор производительности Bitrix, замеряйте «узкие места» до оптимизации.
- Нагрузочные тесты — на отдельном стенде, с близкими к бою данными; фиксируйте целевые SLA (время ответа, RPS, ошибки).
